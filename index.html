<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>kadai</title>
</head>

<body>
    <div class="wrapper">
        <div id="intr">
            <div class="intro" id="intrchapter1">1枚目の説明</div>
            <div class="intro" id="intrchapter2">2枚目の説明</div>
            <div class="intro" id="intrchapter3">3枚目の説明</div>
        </div>
    </div>
    <main>


        <div id="leftarea">
            <h1>ローソク足</h1>
            <h3>陽線</h3>
            <p>始値＞終値（白）</p>
            <h3>陰線</h3>
            <p>始値＜終値（緑）</p>
            <h2>演習</h2>
            <p>右のローソク足チャートから四本値を読み取り下部のボックスに入力してください</p>
            <div id="ans_array_view"></div>
            <p></p>

            <div id="btn_container">
                <div id="save_status"></div>
                <!-- <div><input type="button" value="スタート" id="start" class="btn"></div> -->
                <div><input type="button" value="①チャート生成" id="check" class="btn"></div>
                <div><input type="button" value="②答え合わせ" id="judge" class="btn"></div>
                <div><input type="button" value="③次へ" id="next_step" class="btn"></div>
                <div><input type="button" value="④リトライ" id="all_clear" class="btn"></div>

                <div><input type="button" id="cheat"></div>
            </div>
        </div>
        <div id="mainarea">
            <div id="chart">
                <!--チャートは上-->
                <div id="chart_div">チャート</div>
                <div id="chart_div2"></div>
            </div>
            <!-- ★★★★★http://www.htmq.com/html5/input_type_number.shtml  HTMLタグリファ　あとでstepとmax/minを設定する-->
            <div id="input4">
                <div id="input_div">
                    <!--四本値は下-->
                    <div class="day_container">
                        <div id="day1" class="day">
                            <div>1日目</div>
                            <div>始値<input class="c_1" type="number" min="450" max="700" step="10" id="d1c1"></div>
                            <div>高値<input class="c_2" type="number" min="450" max="700" step="10" id="d1c2"></div>
                            <div>安値<input class="c_3" type="number" min="450" max="700" step="10" id="d1c3"></div>
                            <div>終値<input class="c_4" type="number" min="450" max="700" step="10" id="d1c4"></div>
                        </div>
                        <div id="day2" class="day">
                            <div>２日目</div>
                            <div><input class="c_1" type="number" min="450" max="700" step="10" id="d2c1"></div>
                            <div><input class="c_2" type="number" min="450" max="700" step="10" id="d2c2"></div>
                            <div><input class="c_3" type="number" min="450" max="700" step="10" id="d2c3"></div>
                            <div><input class="c_4" type="number" min="450" max="700" step="10" id="d2c4"></div>
                        </div>
                        <div id="day3" class="day">
                            <div>３日目</div>
                            <div><input class="c_1" type="number" min="450" max="700" step="10" id="d3c1"></div>
                            <div><input class="c_2" type="number" min="450" max="700" step="10" id="d3c2"></div>
                            <div><input class="c_3" type="number" min="450" max="700" step="10" id="d3c3"></div>
                            <div><input class="c_4" type="number" min="450" max="700" step="10" id="d3c4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>


</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script>
    //randomに生成いしてansとしてlocalStorageに保存

    const jsonData = localStorage.getItem('ans');
    let candleData = JSON.parse(jsonData);

    function drawChart(candle, candleData) {

        if (candleData == "") {
            // console.log(candle);

            for (let i = 0; i < 3; i++) {
                let day = []; //この先繰り返す
                day.push(candleData[i][0]); //この先繰り返す
                for (let j = 1; j < 5; j++) {
                    var num = parseFloat(candleData[i][j]);
                    day.push(num);
                }
                candle.push(day)
            }
            let data = new google.visualization.arrayToDataTable([
                candle[0],
                candle[1],
                candle[2]
            ], true);
            // オプションの設定
            let options = {
                legend: 'none',
                vAxis: {
                    minValue: 460,
                    maxValue: 690,
                    gridlines: {
                        count: 20,
                        color: '#0c5020'
                    },
                    title: '株価'
                },
                colors: ['darkslategray', '#004411'],
                animation: {
                    startup: true,
                    duration: 3000
                },
                backgroundColor: '#72a782'
            }
        } else {
            // console.log(candle);
            // console.log(candleData);
            const jsonData = localStorage.getItem('ans');
            let candleData = JSON.parse(jsonData);

            for (let i = 0; i < 3; i++) {
                let day = []; //この先繰り返す
                day.push(candleData[i][0]); //この先繰り返す
                for (let j = 1; j < 5; j++) {
                    var num = parseFloat(candleData[i][j]);
                    day.push(num);
                }
                candle.push(day)
            }
            let data = new google.visualization.arrayToDataTable([
                candle[0],
                candle[1],
                candle[2]
            ], true);
        }
        // 指定されたIDの要素にローソク足を作成
        let chart = new google.visualization.CandlestickChart(document.getElementById('chart_div'));

        // グラフの描画
        chart.draw(data, options);



    };

    $(function() {

        //Googl Chart

        // ライブラリのロード
        // name:visualization(可視化),version:バージョン(1.1),packages:パッケージ(corechart)
        google.load('visualization', '1', {
            'packages': ['corechart']
        });

        // グラフを描画する為のコールバック関数を指定
        google.setOnLoadCallback(drawChart);

        let ans_ = [
            ["1日目", 520, 520, 600, 680],
            ["2日目", 520, 650, 580, 650],
            ["3日目", 490, 550, 520, 600]
        ];

        let ans_jsonData = JSON.stringify(ans_);
        localStorage.setItem('ans', ans_jsonData);

    });
    //回答の配列    
    let ans_array = [];
    let ans_array_jsonData = JSON.stringify(ans_array);
    localStorage.setItem('ans_array', ans_array_jsonData);
    let ans_reduce = "";
    //idの指定
    let csschang = ['#d1c3', '#d1c4', '#d1c1', '#d1c2', "2日目", '#d2c3', '#d2c4', '#d2c1', '#d2c2', "3日目", '#d3c3', '#d3c4', '#d3c1', '#d3c2']

    // drawChart();



    $('#check').on('click', function() {
        let candledata = [
            ["1日目", $('#d1c3').val(), $('#d1c4').val(), $('#d1c1').val(), $('#d1c2').val()],
            ["2日目", $('#d2c3').val(), $('#d2c4').val(), $('#d2c1').val(), $('#d2c2').val()],
            ["3日目", $('#d3c3').val(), $('#d3c4').val(), $('#d3c1').val(), $('#d3c2').val()]
        ];
        console.log(candledata);
        let jsonData = JSON.stringify(candledata);
        localStorage.setItem('candle', jsonData);
        // location.reload();


        drawChart();
    });

    $('#judge').on('click', function() {

        // const alrt = localStorage.getItem('ans_');
        // const judge = JSON.parse(alrt);


        if (ans_ == 0) {
            ans_array.push(1);
            console.log(ans_array);
            let ans_reduce = ans_array.reduce(function(sum, element) {
                return sum + element;
            }, 0);
            let jsonData = JSON.stringify(ans_array);
            localStorage.setItem('ans_array', jsonData);
            alert("正解！！" + ans_reduce + "連続正解");
        } else {
            alert("不正解!もう一度見直そう");
            ans_array.push(0);
            console.log(ans_array);
        }
    });

    $('#next_step').on('click', function() {

    });

    $('#all_clear').on('click', function() {
        localStorage.clear();
        location.reload();
    });
    // $('#start').on('click', function() {
    //     const jsonData = localStorage.getItem('ans');
    //     const candleData = JSON.parse(jsonData);
    //     drawChart(candleData);
    //     console.log(candleData);
    // });

    //検証用に正解の数字を入力できるボタン
    $('#cheat').on('click', function() {
        let basedata = [
            ["1日目", 520, 520, 600, 680],
            ["2日目", 520, 650, 580, 650],
            ["3日目", 490, 550, 520, 600]
        ];
        $('#d1c1').val(basedata[0][3]);
        $('#d1c2').val(basedata[0][4]);
        $('#d1c3').val(basedata[0][1]);
        $('#d1c4').val(basedata[0][2]);
        $('#d2c1').val(basedata[1][3]);
        $('#d2c2').val(basedata[1][4]);
        $('#d2c3').val(basedata[1][1]);
        $('#d2c4').val(basedata[1][2]);
        $('#d3c1').val(basedata[2][3]);
        $('#d3c2').val(basedata[2][4]);
        $('#d3c3').val(basedata[2][1]);
        $('#d3c4').val(basedata[2][2]);



    });
    //---------
</script>

</html>